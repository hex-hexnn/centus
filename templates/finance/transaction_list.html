{% extends 'base.html' %}

{% block content %}
<div class="text-center mb-5">
    <h1 class="display-5 fw-bold">Twoje transakcje</h1>
</div>

<div class="row mb-4 g-3">
    <div class="col-md-3">
        <div class="card text-white bg-success h-100 shadow-sm">
            <div class="card-header bg-transparent border-0">Wp≈Çywy</div>
            <div class="card-body">
                <h4 class="card-title">{{ total_income }} PLN</h4>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-danger h-100 shadow-sm">
            <div class="card-header bg-transparent border-0">Wydatki</div>
            <div class="card-body">
                <h4 class="card-title">{{ total_expense }} PLN</h4>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-primary h-100 shadow-sm">
            <div class="card-header bg-transparent border-0">Bilans</div>
            <div class="card-body">
                <h4 class="card-title">{{ balance }} PLN</h4>
            </div>
        </div>
    </div>

    <div class="col-md-3 d-flex align-items-center justify-content-center">
        <a href="{% url 'transaction_create' %}" class="btn btn-primary btn-lg w-100 h-100 d-flex align-items-center justify-content-center shadow-sm">
            + Dodaj Transakcjƒô
        </a>
    </div>
</div>

<div class="row mt-4">
    
    <div class="col-lg-5 mb-4">
        {% if dashboard_chart %}
        <div class="card shadow h-100">
            <div class="card-header text-center">
                Analiza
            </div>
            <div class="card-body d-flex align-items-center justify-content-center bg-transparent">
                <a href="{% url 'analysis' %}" class="d-block text-decoration-none" title="Kliknij, aby zobaczyƒá szczeg√≥≈Çy">
                    <img src="data:image/png;base64,{{ dashboard_chart }}" 
                         alt="Wykres bilansu" 
                         class="img-fluid"
                         style="transition: transform 0.2s;"
                         onmouseover="this.style.transform='scale(1.02)'"
                         onmouseout="this.style.transform='scale(1)'">
                </a>
            </div>
        </div>
        {% else %}
        <div class="card shadow h-100 d-flex align-items-center justify-content-center p-5">
            <p class="text-muted">Dodaj transakcje, aby zobaczyƒá wykres.</p>
        </div>
        {% endif %}
    </div>

    <div class="col-lg-7">
        <div class="card shadow h-100">
             <div class="card-header">
                Ostatnie operacje
            </div>
            <div class="card-body p-0"> <div class="table-responsive">
                    <table class="table table-hover table-striped mb-0 align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Data</th>
                                <th>Kategoria</th>
                                <th>Kwota</th>
                                <th class="text-end">Akcje</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for transaction in transactions %}
                            <tr>
                                <td>{{ transaction.date|date:"d M Y" }}</td>
                                <td>
                                    <span class="badge rounded-pill {% if transaction.category.type == 'INCOME' %}bg-success{% else %}bg-danger{% endif %}">
                                        {{ transaction.category.name }}
                                    </span>
                                </td>
                                <td class="fw-bold {% if transaction.category.type == 'INCOME' %}text-success{% else %}text-danger{% endif %}">
                                    {{ transaction.amount }} PLN
                                </td>
                                <td class="text-end">
                                    <div class="btn-group btn-group-sm">
                                        <a href="{% url 'transaction_update' transaction.id %}" class="btn btn-outline-secondary">‚úèÔ∏è</a>
                                        <a href="{% url 'transaction_delete' transaction.id %}" class="btn btn-outline-danger">üóëÔ∏è</a>
                                    </div>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center py-4">Brak transakcji.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}